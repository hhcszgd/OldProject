//
//  UserInfoViewModel.m
//  TTmall
//
//  Created by wangyuanfei on 3/2/16.
//  Copyright Â© 2016 Footway tech. All rights reserved.
/**
    è®°å¾—å¢åŠ åˆ¤æ–­è¿”å›çš„dataå­—æ®µä¸ºç©ºæˆ–è€…ç±»å‹ä¸åŒ¹é…çš„æƒ…å†µ
 
 */

#import "UserInfoViewModel.h"
#import "UserInfo.h"
#import "ShopCoupon.h"
//#import "HomeHttpTool.h"
#import "GDXmppStreamManager.h"
#import "AMCellModel.h"//æ”¶è´§åœ°å€æ¨¡å‹

#import "SpecModel.h"

typedef enum : NSUInteger {
    POST,
    GET,
    PUT
} ActionType;

@interface UserInfoViewModel ()
@property(nonatomic,strong)  AFHTTPSessionManager*mar ;
@property(nonatomic,copy)NSString * midPath ;
@property(nonatomic,copy)NSString * endPath ;

@property(nonatomic,strong)UIActivityIndicatorView * activetyIndicator ;

/** å®šæ—¶å™¨ */

//@property(nonatomic,strong)NSTimer * timer ;
/** ç¬¬ä¸€æ¬¡ä¸æç¤ºç½‘ç»œ å˜åŒ– */
@property(nonatomic,assign)NSInteger  time ;
/** ç½‘ç»œæ˜¯å¦å¤„äºè¯·æ±‚çŠ¶æ€ */
@property(nonatomic ,assign)BOOL isRequesting ;

@end
@implementation UserInfoViewModel

static UserInfoViewModel * _viewModel;

//////////////////////////////////////////////////////////////////////////



-(void)performActivetyIndicatorStopAnimating
{
    self.isRequesting = NO ;
    if (self.activetyIndicator.isAnimating)   [self.activetyIndicator stopAnimating];
    LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç»“æŸäº†å•Š");

}

-(void)prepareActivetyIndicatorStartAnimating{
    self.isRequesting = YES;
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_global_queue(0, 0), ^{
        LOG(@"_%@_%d_%@",[self class] , __LINE__,[NSThread currentThread]);
        dispatch_async(dispatch_get_main_queue(), ^{
            LOG(@"_%@_%d_%@",[self class] , __LINE__,[NSThread currentThread]);
            if (self.isRequesting && !self.activetyIndicator.isAnimating) {
                [self.activetyIndicator startAnimating];
                LOG(@"_%@_%d_%@",[self class] , __LINE__,@"æ‰§è¡Œäº†æ²¡å•Š");
            }else{
                LOG(@"_%@_%d_%@%d%d",[self class] , __LINE__,@"æ€ä¹ˆä¸æ‰§è¡Œå‘¢",self.isRequesting,self.activetyIndicator.isAnimating);
            }
            
        });
        
    });
}

-(UIActivityIndicatorView * )activetyIndicator{
    if(_activetyIndicator==nil){
        _activetyIndicator = [[UIActivityIndicatorView alloc]initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleGray];
        [[UIApplication sharedApplication].keyWindow addSubview:_activetyIndicator];
        _activetyIndicator.center = [UIApplication sharedApplication].keyWindow.center;
        /**      [self.activetyIndicator startAnimating];
         [self.activetyIndicator stopAnimating];
         */
    }
    return _activetyIndicator;
}

-(NSString * )midPath{
    if(_midPath==nil){
//        _midPath = @"index.php?m=Api&c=V2/";
        _midPath = @"V2/";
    }
    return _midPath;
}
-(NSString * )endPath{
    if(_endPath==nil){
//        _endPath = @"&a=rest";
        _endPath = @"/rest";
    }
    return _endPath;
}
+(instancetype)shareViewModel{
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        _viewModel = [[UserInfoViewModel alloc]init];
    });
    return _viewModel;
}

-(instancetype)init{
    if (self=[super init]) {
        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(noticeNetworkChanged:) name:AFNetworkingReachabilityDidChangeNotification object:nil];
    }
    return self;
}
-(void)noticeNetworkChanged:(NSNotification*)note
{
    self.time ++ ;
    if (self.time==1) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç¬¬ä¸€æ¬¡ä¸æç¤º");
        return;
    }
    LOG(@"_%@_%d_%ld",[self class] , __LINE__,NetWorkingStatus);
    LOG(@"_%@_%d_%@\n\n%@",[self class] , __LINE__,@"ç½‘ç»œçŠ¶æ€æ”¹å˜äº†",note);
    NSDictionary * userInfo = note.userInfo;
    AFNetworkReachabilityStatus  currentNetwordStates = [userInfo[AFNetworkingReachabilityNotificationStatusItem] integerValue];
    /**     AFNetworkReachabilityStatusUnknown          = -1,
     AFNetworkReachabilityStatusNotReachable     = 0,
     AFNetworkReachabilityStatusReachableViaWWAN = 1,
     AFNetworkReachabilityStatusReachableViaWiFi = 2,
     */
    
    if (currentNetwordStates==AFNetworkReachabilityStatusUnknown) {
        AlertInSubview(@"ç½‘ç»œè¿æ¥å¤±è´¥\nè¯·æ£€æŸ¥ç½‘ç»œ")
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç½‘ç»œæœªçŸ¥");
    }else if (currentNetwordStates==AFNetworkReachabilityStatusNotReachable) {
        AlertInSubview(@"ç½‘ç»œè¿æ¥å¤±è´¥\nè¯·æ£€æŸ¥ç½‘ç»œ")
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç½‘ç»œè¿æ¥å¤±è´¥");
    }else if (currentNetwordStates==AFNetworkReachabilityStatusReachableViaWWAN) {
        AlertInSubview(@"å½“å‰ç½‘ç»œç¯å¢ƒä¸ºç§»åŠ¨èœ‚çªç½‘ç»œ")
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç½‘ç»œæ˜¯ç§»åŠ¨èœ‚çªç½‘ç»œ");
    }else if (currentNetwordStates==AFNetworkReachabilityStatusReachableViaWiFi) {
        AlertInSubview(@"å½“å‰ç½‘ç»œç¯å¢ƒä¸ºwifi")
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"ç½‘ç»œæ˜¯wifi");
    }
}
-(AFHTTPSessionManager * )mar{
    if(_mar==nil){
        NSURL * baseUrl = [NSURL URLWithString:BASEURL];
        _mar = [[AFHTTPSessionManager alloc]initWithBaseURL:baseUrl];
        [_mar.requestSerializer setValue:@"2" forHTTPHeaderField:@"APPID"];
        [_mar.requestSerializer setValue:@"1" forHTTPHeaderField:@"VERSIONID"];
        [_mar.requestSerializer setValue:@"20160501" forHTTPHeaderField:@"VERSIONMINI"];
#pragma mark udidå…ˆå†™æ­»æˆè‡ªå·±æ‰‹æœºçš„udid    @"3436F0B9-E8E4-4BA8-B8BD-7F04EE43CD7F"
        [_mar.requestSerializer setValue:UUID forHTTPHeaderField:@"DID"];
//        [_mar.requestSerializer setValue:@"3436F0B9-E8E4-4BA8-B8BD-7F04EE43CD7F" forHTTPHeaderField:@"DID"];

        LOG(@"_%@_%d_*********è‡ªå·±çš„uuid-->%@",[self class] , __LINE__,UUID);
        _mar.responseSerializer.acceptableContentTypes =[NSSet setWithObjects:@"application/json", @"text/json", @"text/javascript",@"text/html", nil];
    }
    return _mar;
}


-(void)initializationWithUser:(UserInfo *)user {
    [self initializationWithUser:user success:^(ResponseStatus response) {
        
    } failure:^(NSError *error) {
    }];
}
-(void)initializationWithUser:(UserInfo*)user  success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{//å•ç‹¬å°è£…,ä¸ä¾èµ–å…¶ä»–æ–¹æ³•
#pragma è·¯å¾„æ‹¼æ¥
     LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰åˆå§‹åŒ–æ–¹æ³•å¼€å§‹%s",[self class] , __LINE__,__FUNCTION__);
    NSString * url  = [self.midPath stringByAppendingPathComponent:@"InitKey" ] ;
    url = [url stringByAppendingString:self.endPath];
//    LOG(@"_%@_%d_%@",[self class] , __LINE__,self.mar.baseURL);
//    LOG(@"_%@_%d_%@",[self class] , __LINE__,url);
    
    [self.mar GET:url parameters:nil progress:nil success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
         LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰åˆå§‹åŒ– æ–¹æ³•ç»“æŸ%s",[self class] , __LINE__,__FUNCTION__);
        if ([responseObject isKindOfClass:[NSDictionary class]]) {
            //                LOG(@"_%@_%d_%@",[self class] , __LINE__,responseObject)
            ResponseObject * response = [[ResponseObject alloc]initWithDict:responseObject];
            
            if (response.status > 0) {
                LOG(@"_%@_%d_%@ , å³å°†åˆæˆtoken",[self class] , __LINE__,response.msg)
#pragma mark å…ˆå†™æ­»ä¸ºè‡ªå·±æ‰‹æœºçš„udid
                NSString * result =   [UUID  stringByAppendingString:response.data];
//                NSString * result =   [@"3436F0B9-E8E4-4BA8-B8BD-7F04EE43CD7F"  stringByAppendingString:response.data];
                
                result = [result md5String];
                user.token=result;
                
                LOG(@"_%@_%d_%d",[self class] , __LINE__,[GDXmppStreamManager ShareXMPPManager].XmppStream.isConnected);
                LOG(@"_%@_%d_%d",[self class] , __LINE__,[GDXmppStreamManager ShareXMPPManager].XmppStream.isConnecting);
                LOG(@"_%@_%d_%d",[self class] , __LINE__,user.isLogin);
                
                if ((![GDXmppStreamManager ShareXMPPManager].XmppStream.isConnected && ![GDXmppStreamManager ShareXMPPManager].XmppStream.isConnecting) && user.isLogin) {
                    LOG(@"_%@_%d_ç™»å½•IMæ—¶ç”¨å¾—token%@",[self class] , __LINE__,[UserInfo shareUserInfo].token);
                    LOG(@"_%@_%d_%@",[self class] , __LINE__,[UserInfo shareUserInfo].imName);
                    LOG(@"_%@_%d_%@",[self class] , __LINE__,[UserInfo shareUserInfo].token);
                        [[GDXmppStreamManager ShareXMPPManager]loginWithJID:[XMPPJID jidWithUser:[UserInfo shareUserInfo].imName domain:@"jabber.zjlao.com" resource:@"iOS"] passWord:[UserInfo shareUserInfo].token];
                        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"æ‰§è¡Œç™»å½•");
                }
                
                
                LOG(@"_%@_%d_     ç”ŸæˆtokenæˆåŠŸ%@",[self class] , __LINE__,result)
            }else{
                LOG(@"_%@_%d_  åˆå§‹åŒ–æ–¹æ³•ä¸­ , è¯·æ±‚æˆåŠŸ , ä½†æ“ä½œå¤±è´¥ , æ“ä½œå¤±è´¥ä¿¡æ¯%@",[self class] , __LINE__,responseObject)
            }
            
            success(response.status);
            
        }else if ([responseObject isKindOfClass:[NSArray class]]){
            LOG(@"_%@_%d_%@",[self class] , __LINE__,@"è¿”å›æ•°æ®ä¸ºarr ")
        }else{
            LOG(@"_%@_%d_%@",[self class] , __LINE__,@"è¿”å›æ•°æ®éarr & Dic")
        }
        if ([self.delegate respondsToSelector:@selector(initializationSuccess)]) {
            [self.delegate initializationSuccess];
        }
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        failure(error);
         LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰åˆå§‹åŒ–(å¤±è´¥)æ–¹æ³•ç»“æŸ%s",[self class] , __LINE__,__FUNCTION__);
        LOG(@"_%@_%d_åˆå§‹åŒ–å¤±è´¥------%@",[self class] , __LINE__,error)
        
    }];
    
    
}
#pragma ä¸Šä¼ å¤´åƒ(å¸¸è§„ç‰ˆ)
//-(void)uploadPictureWithUser:(UserInfo *)user picData:(NSData*)picData success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{
//    NSDictionary * parameters = @{
//                                  @"member_id":user.member_id,//head_images
//                                  };
//#pragma è·¯å¾„æ‹¼æ¥
//    
//
//    NSString * urlStr = @"HeadImg";
//    urlStr = [urlStr stringByAppendingString:self.endPath];
//    urlStr = [self.midPath stringByAppendingPathComponent:urlStr];
//    [self.mar POST:urlStr parameters:parameters constructingBodyWithBlock:^(id<AFMultipartFormData>  _Nonnull formData) {
//        UIImage *img = [UIImage imageNamed:@"meinv08"];
//        NSData * data =     UIImagePNGRepresentation(img);
//        [formData appendPartWithFileData:data name:@"images" fileName:@"head_images.png" mimeType:@"image/png"];
//        
//    } progress:^(NSProgress * _Nonnull uploadProgress) {
//        LOG(@"_%@_%d_%lld,%lld",[self class] , __LINE__,uploadProgress.completedUnitCount,uploadProgress.totalUnitCount)
//        LOG(@"_%@_%d_%@",[self class] , __LINE__,uploadProgress)
//    } success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
//        LOG(@"_%@_%d_%@",[self class] , __LINE__,responseObject)
//        LOG(@"_%@_%d_%@",[self class] , __LINE__,task)
//        
//    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
//        LOG(@"_%@_%d_%@",[self class] , __LINE__,error)
//    }];
//    
//}
#pragma ä¸Šä¼ å¤´åƒ(base64)
-(void)uploadPictureWithUser:(UserInfo *)user picBase64:(NSString*)picBase64   targetType:(NSUInteger)type  success:(void(^)(id response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                                  @"member_id":user.member_id,
                                  @"headImg":picBase64,
                                  @"type":@(type)
                                  };

    NSString * urlStr = @"HeadImg";
    [self remoteLoadDataWithUrl:urlStr Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response)

        success(response);
    } failure:^(NSError *error) {
        failure(error);
        LOG(@"_%@_%d_%@",[self class] , __LINE__,error)
    }];
}
-(void)remoteLoadDataWithUrl:(NSString*)url Parameters:(id)parameters actionType:(ActionType)type success:(void(^)(ResponseObject* response))success failure:(void(^)(NSError*error))failure{
#pragma è·¯å¾„æ‹¼æ¥
    
    url = [self.midPath stringByAppendingPathComponent:url];
    url = [url stringByAppendingString:self.endPath];
    NSMutableDictionary * para = [[NSMutableDictionary alloc]initWithDictionary:parameters];
    
    if ([UserInfo shareUserInfo].token) {
        
        [self fatherRemoteMethodWithURL:url Parameters:para actionType:type success:^(ResponseObject *response) {
            if (response.status>0) {
                //                success(response);
            }else{
                LOG(@"_%@_%d_è¯·æ±‚æˆåŠŸ , ä½†æ“ä½œå¤±è´¥  å¤±è´¥ä¿¡æ¯%@ , å¯¹åº”çš„url: %@",[self class] , __LINE__,response.msg,url)
                LOG(@"_%@_%d_çŠ¶æ€ç    -----> %d",[self class] , __LINE__,response.status)
            }
            success(response); //æ— è®ºæ“ä½œæˆåŠŸä¸å¦, æ•°æ®è¿˜æ˜¯è¦è¿”å›çš„
        } failure:^(NSError *error) {
            failure(error);
        }];
        
    }else{
        if (![UserInfo shareUserInfo].token) {
            LOG(@"_%@_%d_XXXXXXXXXXXXXXXXXX--->%@",[self class] , __LINE__,@"tokenä¸ºç©º , å³å°†é‡æ–°ç”Ÿæˆ")
        }
        [self initializationWithUser:[UserInfo shareUserInfo] success:^(ResponseStatus response) {
            if (response>0) {
                
                [self fatherRemoteMethodWithURL:url Parameters:para actionType:type success:^(ResponseObject *response) {
                    if (response.status>0) {
                    }else{
                        LOG(@"_%@_%d_è¯·æ±‚æˆåŠŸ , ä½†æ“ä½œå¤±è´¥  å¤±è´¥ä¿¡æ¯%@ , å¯¹åº”çš„url: %@",[self class] , __LINE__,response.msg,url)
                        LOG(@"_%@_%d_çŠ¶æ€ç    -----> %d",[self class] , __LINE__,response.status)
                    }
                    success(response);
                } failure:^(NSError *error) {
                    failure(error);
                }];
                
            }else{
                LOG(@"_%@_%d_è¯·æ±‚æˆåŠŸ , ä½†æ“ä½œå¤±è´¥  çŠ¶æ€ç %d , å¯¹åº”çš„url: %@",[self class] , __LINE__,response,url)
                
            }
            
        } failure:^(NSError *error) {
            failure(error);
        }];
    }
    
}
-(void)fatherRemoteMethodWithURL:(NSString*)url Parameters:(id)parameters actionType:(ActionType)type success:(void(^)(ResponseObject* response))success failure:(void(^)(NSError*error))failure{
    
    [self prepareActivetyIndicatorStartAnimating];
//    if (!self.activetyIndicator.isAnimating)  [self.activetyIndicator startAnimating];

    NSMutableDictionary * para = [[NSMutableDictionary alloc]initWithDictionary:parameters];
    
    [para setValue:[UserInfo shareUserInfo].token forKey:@"token"];
    LOG(@"_%@_%d_%@",[self class] , __LINE__,para);
    if (type==POST) {
        LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚å¼€å§‹(post) urlä¸º->%@ ,",[self class] , __LINE__,url);
        [self.mar POST:url parameters:para progress:nil success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
            
            [self performActivetyIndicatorStopAnimating];
//            [self.activetyIndicator stopAnimating];
            
            LOG(@"_%@_%d_%@",[self class] , __LINE__,responseObject)
            if ([responseObject isKindOfClass:[NSDictionary class]]) {
                ResponseObject * response = [[ResponseObject alloc]initWithDict:responseObject];
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(post)æˆåŠŸ urlä¸º->%@ çŠ¶æ€ä¿¡æ¯->%@",[self class] , __LINE__,url,response.msg);
                success(response);
            }else if ([responseObject isKindOfClass:[NSArray class]]){
                 LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(post) urlä¸º->%@ è¿”å›æ•°æ®ä¸ºarr",[self class] , __LINE__,url);
            }else{
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(post) urlä¸º->%@ è¿”å›æ•°æ®éarr & Dic",[self class] , __LINE__,url);

            }
        } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
//            [self.activetyIndicator stopAnimating];
             [self performActivetyIndicatorStopAnimating];
            LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(post) urlä¸º->%@ é”™è¯¯ä¿¡æ¯ä¸º%@,",[self class] , __LINE__,url,error);
            failure(error);
        }];
    }else if (type==GET){
         LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚å¼€å§‹(get) urlä¸º->%@ ,",[self class] , __LINE__,url);
        
        [self.mar GET:url parameters:para progress:nil success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
//            [self.activetyIndicator stopAnimating];
             [self performActivetyIndicatorStopAnimating];
//                        LOG(@"_%@_%d_%@",[self class] , __LINE__,responseObject)
            
            if ([url isEqualToString:@"V2/IndexPage/rest"]) {////////////è¦æ”¹è¦æ”¹//////////
                NSDictionary * dict = ( NSDictionary * ) responseObject;
                NSString *docPath=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)lastObject];
                NSString *path=[docPath stringByAppendingPathComponent:@"HomeData.plist"];
                
                BOOL chenggong =  [dict writeToFile:path atomically:YES];
                LOG(@"_%@_%d_æ›´æ–°é¦–é¡µæ•°æ®è‡³æ²™ç›’æˆåŠŸä¸å¦ - > %d",[self class] , __LINE__,chenggong);
            }
            
//            if ([url isEqualToString:@"V2/MyPage/rest"]) {////////////è¦æ”¹è¦æ”¹//////////
//                NSDictionary * dict = ( NSDictionary * ) responseObject;
//                NSString *docPath=[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)lastObject];
//                NSString *path=[docPath stringByAppendingPathComponent:@"ProfileData.plist"];
//                
//                BOOL chengtong =  [dict writeToFile:path atomically:YES];
//                LOG(@"_%@_%d_å†™å…¥ä¸ªäººæ•°æ®ç»“æœ%d",[self class] , __LINE__,chengtong);
//            }
            
            if ([responseObject isKindOfClass:[NSDictionary class]]) {
                ResponseObject * response = [[ResponseObject alloc]initWithDict:responseObject];
                
                  LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(get)æˆåŠŸ urlä¸º->%@ çŠ¶æ€ä¿¡æ¯->%@",[self class] , __LINE__,url,response.msg);
                success(response);
            }else if ([responseObject isKindOfClass:[NSArray class]]){
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(get) urlä¸º->%@ è¿”å›æ•°æ®ä¸ºarr",[self class] , __LINE__,url);
            }else{
               LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(get) urlä¸º->%@ è¿”å›æ•°æ®éarr & Dic",[self class] , __LINE__,url);
            }
            
        } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
//            [self.activetyIndicator stopAnimating];
            LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(get) urlä¸º->%@ é”™è¯¯ä¿¡æ¯ä¸º%@,",[self class] , __LINE__,url,error);
             [self performActivetyIndicatorStopAnimating];
            failure(error);
            //          LOG(@"_%@_%d_%@",[self class] , __LINE__,error.userInfo[@"NSLocalizedDescription"])
            LOG(@"_%@_%d_%@",[self class] , __LINE__,error)
        }];
    }else if (type==PUT){
         LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚å¼€å§‹(put) urlä¸º->%@ ,",[self class] , __LINE__,url);
        [self.mar PUT:url parameters:para success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
//            [self.activetyIndicator stopAnimating];
             [self performActivetyIndicatorStopAnimating];
            LOG(@"_%@_%d_%@",[self class] , __LINE__,responseObject)
            if ([responseObject isKindOfClass:[NSDictionary class]]) {
                ResponseObject * response = [[ResponseObject alloc]initWithDict:responseObject];
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(put)æˆåŠŸ urlä¸º->%@ çŠ¶æ€ä¿¡æ¯->%@",[self class] , __LINE__,url,response.msg);
                success(response);
            }else if ([responseObject isKindOfClass:[NSArray class]]){
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(put) urlä¸º->%@ è¿”å›æ•°æ®ä¸ºarr",[self class] , __LINE__,url);
                
            }else{
                LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(put) urlä¸º->%@ è¿”å›æ•°æ®éarr & Dic",[self class] , __LINE__,url);
            }
            
        } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
//            [self.activetyIndicator stopAnimating];
            LOG(@"_%@_%d_ğŸ‘‰ğŸ‘‰ğŸ‘‰è¯·æ±‚ç»“æŸ(put) urlä¸º->%@ é”™è¯¯ä¿¡æ¯ä¸º%@,",[self class] , __LINE__,url,error);
             [self performActivetyIndicatorStopAnimating];
            failure(error);
            //            LOG(@"_%@_%d_%@",[self class] , __LINE__,error.userInfo[@"NSLocalizedDescription"])
        }];
    }
    
}

/** æ³¨å†Œæ¥å£ */
-(void)registerWithUser:(UserInfo*)user Success:(void(^)(ResponseObject *response))success failure:(void(^)(NSError*error))failure{
    LOG(@"_%@_%d_%@",[self class] , __LINE__ , user.mobileCode);
    
    NSDictionary * parameters = @{
                   @"name": user.name,
                   @"password": user.password,
                   @"mobilecode":user.mobileCode,
                   @"mobile":user.mobile
                    };
    NSString *url  =  @"Register";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        
//        [self loginWithUser:user success:^(ResponseStatus response) {
//            
////            success(response);
//        } failure:^(NSError *error) {
//            failure(error);
//        }];
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

//#pragma è¿™ä¸ªæ¥å£è¦æ”¹, æ·»åŠ ä¸€ä¸ªç±»å‹å‚æ•°
-(void)gotMobileCodeWithUser:(UserInfo*)user mobileCodeType:(MobileCodeType)type Success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{
    [self initializationWithUser:user success:^(ResponseStatus response) {
        
        NSDictionary * parameters = @{
                               @"mobile":user.mobile,
                               @"type":@(type)//1æ³¨å†Œ2æ‰¾å›å¯†ç 
                               };
        NSString * url = @"ShortMessage";
        [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
//            LOG(@"_%@_%d_%@",[self class] , __LINE__,response.msg)
            success(response.status);
        } failure:^(NSError *error) {
            failure(error);
        }];
    } failure:^(NSError *error) {
        failure(error);
    }];
}
-(void)loginWithUser:(UserInfo *)user success:(void (^)(ResponseStatus response))success failure:(void (^)(NSError *))failure{//è¿™ä¸ªæˆåŠŸå›è°ƒå€¼æœ‰ä¸¤ç§å¯èƒ½
    
        NSDictionary * parameters = @{
                               @"username": user.name,
                               @"password": user.password
                               };
        NSString * url =   @"Login";
    
        [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
            if (response.status>0 ) {
                
                LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data)
                NSString * result =  response.data;
                user.member_id = result ;
                [self gotPersonalInfWithUser:user success:^(ResponseStatus response) {
                    [[GDXmppStreamManager ShareXMPPManager]loginWithJID:[XMPPJID jidWithUser:user.imName domain:@"jabber.zjlao.com" resource:@"iOS"] passWord:user.token];
                } failure:^(NSError *error) {
                    failure(error);
                }];
                [self gotShopingCarWithUser:user success:^(ResponseStatus response) {
                    
                } failure:^(NSError *error) {
                     failure(error);
                }];
                
                
                
//                [[GDXmppStreamManager ShareXMPPManager]loginWithJID:[XMPPJID jidWithUser:user.imName domain:@"jabber.zjlao.com" resource:@"iOS"] passWord:user.token];
            }
            success(response.status);//ç™»å½•æˆåŠŸå›è°ƒ
            [[NSNotificationCenter defaultCenter] postNotificationName:LOGINSUCCESS object:nil];
        } failure:^(NSError *error) {
              failure(error);
        }];
}

-(void)gotPersonalInfWithUser:(UserInfo *)user success:(void (^)(ResponseStatus response))success failure:(void (^)(NSError *))failure{
    
    NSDictionary * parameters = @{
                           @"member_id":user.member_id
                           };
    NSString * url =  @"UserInfo";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
//        if (response.status==GET_USERINFO_SUCESS) {
        LOG(@"_%@_%d_è·å–çš„ä¸ªäººä¿¡æ¯\n%@\n",[self class] , __LINE__,response.msg);
    if (response.status>0) {
        NSArray * arr = response.data;
            NSDictionary * result = arr.firstObject;
            [user setValuesForKeysWithDictionary:result];
            user.password = nil;
            [user save];
        }
        success(response.status);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma è´­ç‰©è½¦æ“ä½œ
/** æ·»åŠ è´­ç‰©è½¦ */
-(void)addShopingCarWithUser:(UserInfo*)user goods_id:(NSString *)goods_id goodsNum:(NSInteger)num sub_id:(NSInteger)sub_id now:(NSString *)now Success:(void(^)(ResponseObject *response))success failure:(void(^)(NSError*error))failure{
    
        NSDictionary * parameters = @{
                               @"member_id":user.member_id,
                               @"goods_id":goods_id,
                               @"num":@(num),
                               @"spec":@(sub_id),
                               @"now":now
                               };
    LOG(@"_%@_%d_%@",[self class] , __LINE__,parameters);
        NSString*url =  @"ShopCart";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
//        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.msg)
        if (response.status>0) {
             [[NSNotificationCenter defaultCenter] postNotificationName:SHOPCARDATACHANGED object:nil];
        }
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** è·å–è´­ç‰©è½¦æ•°æ® */
-(void)gotShopingCarWithUser:(UserInfo*)user  success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{

    NSDictionary * parameters = @{
                           @"member_id":user.member_id
                           };
    NSString * url = @"ShopCart" ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        //è·å–è´­ç‰©è½¦å•†å“ä¿¡æ¯
        
        if (response.status > 0 &&response.data!=nil && [response.data isKindOfClass:[NSDictionary class]]) {
            LOG(@"_%@_%d_%@",[self class] , __LINE__,response.msg)
            LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
            id goodsnumObject =response.data[@"goodsnum"];
            if ([goodsnumObject isKindOfClass:[NSNumber class]]) {
               user.shoppingCarGoodsCount = [goodsnumObject integerValue];
            }
            NSMutableArray * shopS = [NSMutableArray array];
            for (int i = 0 ;  i< [response.data[@"list"] count]; i++) {
                NSDictionary * shopDict = response.data[@"list"][i];
                SVCShop * shopModel =  [[SVCShop alloc] initWithDict:shopDict];
                NSMutableArray * goodses = [NSMutableArray array];
                for (int j  = 0 ;  j <shopModel.list.count ;  j ++) {
                    NSMutableArray * sub_itemsArrM = [NSMutableArray array];
                    NSDictionary * goodsDict = shopModel.list[j];
                    if ([goodsDict[@"sub_items"] isKindOfClass:[NSArray class]] && [goodsDict[@"sub_items"] count] >0) {
                        NSArray * sub_items  = goodsDict[@"sub_items"];
                        for (int i = 0 ; i<sub_items.count; i++) {
                            if ([sub_items[i] isKindOfClass:[NSDictionary class]]) {
                                SpecModel * specModel = [[SpecModel alloc]initWithDict:sub_items[i]];
                                [sub_itemsArrM addObject:specModel];
                            }
                        }
//                        [goodsDict setValue:sub_itemsArrM forKey:@"sub_items"];
                    }
                    
                    
                    SVCGoods * goods =    [[SVCGoods alloc]initWithDict:goodsDict];
                    goods.sub_items = sub_itemsArrM;
                    [goodses  addObject:goods];
                }
                shopModel.list = goodses;
                NSMutableArray * shopCoupons = [NSMutableArray array];
                for (int j  = 0 ;  j <shopModel.coupons.count ;  j ++) {
                    NSDictionary * goodsDict = shopModel.coupons[j];
                    ShopCoupon * shopCoupon =    [[ShopCoupon alloc]initWithDict:goodsDict];
                    [shopCoupons  addObject:shopCoupon];
                }
                shopModel.coupons = shopCoupons;
                [shopS addObject:shopModel];
            }
            user.shoppingCarData=shopS;
        }else{
            user.shoppingCarData=nil;
        }
        success(response.status);//å†åœ¨tableViewçš„æ§åˆ¶å™¨åˆ¤æ–­çŠ¶æ€ç  åšå‡ºç›¸åº”çš„æ“ä½œ   æˆåŠŸçš„è¯åˆ·æ–°tableView
    } failure:^(NSError *error) {
        user.shoppingCarData=nil;;;;;;;;;;;;;
        failure(error);
        LOG(@"_%@_%d_%@",[self class] , __LINE__,error)
    }];
}
/**è·å–è´­ç‰©è½¦æ•°é‡*/
- (void)gotShopCarNumberWithUser:(UserInfo *)user Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"ShopCartNumber";
    NSDictionary *paramete = @{};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
         NSLog(@"\n\n\n\n\n\n_%d_%@\n\n\n\n\n\n\n\n",__LINE__,response.data);
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** åˆ é™¤è´­ç‰©è½¦ */
-(void)deleteShopingCarWithUser:(UserInfo *)user goodsID:(NSInteger)goodsID success:(void (^)(ResponseStatus response))success failure:(void (^)(NSError *))failure{
    
    NSDictionary * parameters = @{
                           @"member_id":user.member_id,
                           @"_method":@"delete",
                           @"select_id":@(goodsID)
//                           @"id":@(goodsID)
                           };
    NSString * url = @"ShopCart" ;
    LOG(@"_%@_%d_%ld",[self class] , __LINE__,goodsID);
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        if (response.status>0) {
             [[NSNotificationCenter defaultCenter] postNotificationName:SHOPCARDATACHANGED object:nil];
        }
        success(response.status);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æ›´æ”¹è´­ç‰©è½¦å•†å“æ•°é‡ */
-(void) changeCountOfGoodsInShopingCarWithUser:(UserInfo*)user goodsId:(NSUInteger)goodsId goodsNum:(NSUInteger)goodsNum success:(void(^)(ResponseObject *response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                                  @"member_id":user.member_id,
                                  @"number":@(goodsNum),
                                  @"id":@(goodsId),
                                  @"_method":@"put"
                                  };
    NSString * url = @"ShopCart" ;
    LOG(@"_%@_%d_%ld",[self class] , __LINE__,goodsId);

    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        success(response);
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.msg)
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** ç¡®è®¤è®¢å•æ¥å£ , å•†å“idé€šè¿‡å­—ç¬¦ä¸²çš„å½¢å¼ä¼ é€’ç»™goods_id å­—æ®µ  å¤šä¸ªgoodsidå°±ç”¨ , è¿æ¥ */
-(void)confirmOrderWithUser:(UserInfo*)user goodsId:(NSString*)goodsId addressID:(NSString*)addressID success:(void(^)(ResponseObject *response))success failure:(void(^)(NSError*error))failure{
    LOG(@"_%@_%d_%@",[self class] , __LINE__,goodsId)
    NSDictionary * parameters =nil ;
    if (addressID) {
         parameters = @{
                                      @"member_id":user.member_id,
                                      @"select_id":goodsId,
                                      @"address_id":addressID
                                      };
    }else{
         parameters = @{
                                      @"member_id":user.member_id,
                                      @"select_id":goodsId,
                                      };
    }

    NSString * url = @"ConfirmOrder" ;

    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}
//TODO
/** é¦–é¡µç‚¹å‡»è¿›å…¥è·å–ä¼˜æƒ åˆ¸ */
-(void)gotCouponsDataWithUser:(UserInfo*)user  pageNum:(NSUInteger)pageNum price_id:(NSUInteger)price_id classify_id:(NSUInteger)classify_id  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
LOG(@"_%@_%d_%ld",[self class] , __LINE__,pageNum);
LOG(@"_%@_%d_%ld",[self class] , __LINE__,price_id);
LOG(@"_%@_%d_%ld",[self class] , __LINE__,classify_id);
    NSDictionary * parameters = @{
                                  @"member_id":user.member_id,
                                  @"price_id":@(price_id),
                                  @"classify_id":@(classify_id),
                                  @"page":@(pageNum)
                                  };
    NSString * url = @"Coupons" ;
    /** GET: http://api.zjlao.com/Coupons&a=rest */
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%d",[self class] , __LINE__,response.status);
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    

}
#pragma mark -- å‚å®¶ç›´é”€é¡µé¢
- (void)gotFactorySellWithUser:(UserInfo *)user success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"DirectDeail";
    [self remoteLoadDataWithUrl:url Parameters:nil actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- å¥³å©´ç®¡
- (void)gotBabyWithUser:(UserInfo *)user success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"Baby";
    [self remoteLoadDataWithUrl:url Parameters:nil actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
#pragma mark -- ç‰¹è®¸ç»è¥
- (void)gotFranchiseWithUser:(UserInfo *)user succss:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"Franchise";
    [self remoteLoadDataWithUrl:url Parameters:@{} actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma mark -- è¶…å¸‚
- (void)gotSuperMarketWithUser:(UserInfo *)user succss:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"superMarket";
    [self remoteLoadDataWithUrl:url Parameters:@{} actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- è¶…å¸‚åˆ†ç±»
- (void)gotSuperMarketClassisyWithUser:(UserInfo *)user success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"SupMarketClassfy";
    [self remoteLoadDataWithUrl:url Parameters:@{} actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
- (void)gotSuperMarketThreeLevelClassisyWithUser:(UserInfo *)user andClassID:(NSUInteger)classID channel_id:(NSString *)channel_id success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"SupMarketSubClassfy";
    [self remoteLoadDataWithUrl:url Parameters:@{@"class_id":@(classID),@"channel_id":channel_id} actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma mark -- ç”µå™¨åŸ
- (void)gotHomeAppliancesCenterWithUser:(UserInfo *)user succss:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"EA";
    [self remoteLoadDataWithUrl:url Parameters:@{} actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}


#pragma å•†å“æ”¶è—æ“ä½œ
-(void)addGoodsFavoriteWithUser:(UserInfo*)user goods_id:(NSString *)goods_id   Success:(void(^)(ResponseObject *))success failure:(void(^)(NSError*))failure{
    NSDictionary * parameters = @{
                           @"member_id":user.member_id,
                           @"goods_id":goods_id
                           };
    NSString * url = @"GoodsCollect"  ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        if (response.status==POST_GOODS_COLLECT_SUCESS) {
            //æ”¶è—æˆåŠŸ , tipsè¯¦ç»†çŠ¶æ€ç å·²è¢«æœåŠ¡å™¨ç«¯å¯ç”¨ ç”¨æ­£è´Ÿæ¥æ ‡è¯†æˆåŠŸä¸å¦
        }
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
-(void)gotGoodsFavoriteWithUser:(UserInfo*)user  success:(void(^)(ResponseObject* response))success failure:(void(^)(NSError*error))failure{
    NSLog(@"%@, %d ,%@",[self class],__LINE__,user.member_id);

    NSDictionary * parameters = @{
                           @"member_id":user.member_id
                           };
    NSString*url =  @"GoodsCollect"  ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/**åˆ¤æ–­åº—é“ºæ˜¯å¦æ”¶è—*/
- (void)judgeShopIsCollectionWithUser:(UserInfo *)user shopID:(NSString *)shopID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
     LOG(@"%d,%@",__LINE__,user.member_id)
    NSDictionary *paramete =@{@"member_id":user.member_id,
                              @"shop_id":shopID
                              };
    NSString *url = @"IsShopCollect";
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/**å’¨è¯¢ä¸åé¦ˆ*/
- (void)gotAskAndFeedWithUser:(UserInfo *)user success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"MyAdvice";
    NSDictionary *paramete = @{};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/**ä½“éªŒé—®é¢˜*/
- (void)gotFeedBackDataWithUser:(UserInfo *)user Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *dic = @{@"did":UUID};
    NSString *url = @"Feedback";
    [self remoteLoadDataWithUrl:url Parameters:dic actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/**è·å¾—ä½“éªŒé—®é¢˜*/
- (void)postFeedBackDataWithUser:(UserInfo *)userInfo questionType:(NSString *)questionType questionDesc:(NSString *)questionDesc Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"Feedback";
    NSDictionary *paramete = @{@"did":UUID,
                               @"questionType":questionType,
                               @"questionDesc":questionDesc};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}



/**æŠ•è¯‰é—®é¢˜*/
- (void)gotComplaintDataWithUser:(UserInfo *)user Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *paramete = @{@"did":UUID};
    NSString *url = @"Complaint";
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}



/**åˆ¤æ–­å•†å“æ˜¯å¦æ·»åŠ æ”¶è—*/
- (void)judgeGoodsIsCollectionWithUser:(UserInfo *)user GoodsID:(NSString *)goodsID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *paramete =@{@"member_id":user.member_id,
                              @"goods_id":goodsID
                              };
    NSString *url = @"IsGoodsCollect";
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
-(void)deleteGoodsFavoriteWithUser:(UserInfo*)user  goodsID:(NSString *)goodsID success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                           @"member_id":user.member_id,
                           @"_method":@"delete",
                           @"goods_id":goodsID
                           };
    NSString* url =   @"GoodsCollect" ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        success(response.status);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma åº—é“ºæ”¶è—æ“ä½œ

-(void)addShopFavoriteWithUser:(UserInfo*)user shop_id:(NSString *)shop_id   Success:(void(^)(ResponseObject*))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                           @"member_id":user.member_id,
                           @"shop_id":shop_id
                           };
    NSString*url = @"ShopCollect" ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
-(void)gotShopFavoriteWithUser:(UserInfo*)user  success:(void(^)(ResponseObject* response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                           @"member_id":user.member_id
                           };
    NSString * url = @"ShopCollect" ;
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

-(void)deleteShopFavoriteWithUser:(UserInfo*)user  shop_id:(NSString *)shop_id success:(void(^)(ResponseStatus response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * parameters = @{
                           @"member_id":user.member_id,
                           @"shop_id":shop_id,
                           @"_method":@"delete"
                           };
    NSString * url = @"ShopCollect";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:POST success:^(ResponseObject *response) {
        success(response.status);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma è·å–æ‰€æœ‰åˆ†ç±»
-(void)gotClassifyWithUser :(UserInfo*)user success:(void(^)(ResponseObject * response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * Parameters = @{};
    NSString * url =@"GoodsClassfy";
    
    [self remoteLoadDataWithUrl:url Parameters:Parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}

#pragma è·å–å­åˆ†ç±»
-(void)gotSubClassifyWithUser :(UserInfo*)user andClassID:(NSUInteger)classID success:(void(^)(ResponseObject* response))success failure:(void(^)(NSError*error))failure{
    NSDictionary * Parameters = @{
                                  @"class_id": @(classID)
                                  };

    NSString * url =@"GoodsSubClass";

    [self remoteLoadDataWithUrl:url Parameters:Parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- è·å–å•†å“åˆ—è¡¨
- (void)gotListOfGoodsWithUser:(UserInfo *)user classID:(NSInteger)classID pageNumber:(NSInteger)pageNuber sort:(NSInteger)sort sortOrder:(NSString *)sortOrder success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    
    NSDictionary *parameters = @{
                                 @"by":sortOrder,
                                 @"cat_id":@(classID),
                                 @"order":@(sort),
                                 @"page":@(pageNuber)
                                 };
    NSString *url = @"GoodsList";
    
   
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}



#pragma è·å–å•†å“è¯¦æƒ…
-(void)gotGoodsDetailDataWithUser:(UserInfo*)user goodsID:(NSString *)goodsID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    NSDictionary * Parameters = @{
                                  @"goods_id": goodsID
                                  };

    NSString * url =@"GoodsItem";
    [self remoteLoadDataWithUrl:url Parameters:Parameters actionType:GET success:^(ResponseObject *response) {
        success(response);

    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- è·å–å•†å“è¯¦æƒ…é¡µé¢çš„è¯„ä»·
- (void)gotEvaluateOfGoodsWithUser:(UserInfo *)user goodsID:(NSString *)goodsID evluation:(NSInteger)evluate  page:(NSInteger)page success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *parameters = @{@"goods_id":goodsID,
                                @"search":@(evluate),
                                 @"page":@(page)};
    NSString *url = @"GoodsComment";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
#pragma mark -- å•†å“è¯¦æƒ…é¡µé¢
- (void)gotProductDetailWithUser:(UserInfo *)user goodID:(NSString *)goodID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"GoodsDetail";
    NSDictionary *parameters = @{@"goods_id":goodID};
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma  mark -- çœ‹äº†åˆçœ‹é¡µé¢
- (void)gotProdectSeeAndSeeWithUser:(UserInfo *)user GoodID:(NSString *)goodID page:(NSInteger)page success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"LookAgain";
    NSDictionary *paramters = @{@"goods_id":goodID,
                                @"page":@(page)};
    [self remoteLoadDataWithUrl:url Parameters:paramters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- æ·»åŠ å•†å“è¶³è¿¹
- (void)addGoodsFootmarkWithUser:(UserInfo *)user member_id:(NSString*)member_id cat_id:(NSInteger)cat_id goods_id:(NSInteger)goods_id success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *paramete = @{@"member_id":user.member_id,@"cat_id":@(cat_id),@"goods_id":@(goods_id)};
    NSString *url = @"GoodsFoot";
    [self.mar POST:url parameters:paramete progress:^(NSProgress * _Nonnull uploadProgress) {
        
    } success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
        success(responseObject);
        LOG(@"%@,%d,%@",[self class], __LINE__,@"å•†å“è¶³è¿¹ä¸Šä¼ æˆåŠŸ")
    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
        failure(error);
        LOG(@"%@,%d,%@",[self class], __LINE__,@"å•†å“è¶³è¿¹ä¸Šä¼ å¤±è´¥")
    }];
}

#pragma mark -- è·å–å•†å“è§„æ ¼
- (void)gotGoodsSpecWithUser:(UserInfo *)user goods_id:(NSString *)goodID succes:(void (^)(ResponseObject *))succes failure:(void (^)(NSError *))failure{
    NSString *url = @"SelectSpec";
    NSDictionary *paramete = @{@"goods_id":goodID};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
        succes(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}




#pragma åº—é“ºé¦–é¡µ

-(void)gotShopDetailDataWithUser:(UserInfo*)user shopID:(NSString *)shopID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    LOG(@"_%@_%d_%@",[self class] , __LINE__,shopID);
    NSDictionary * Parameters = @{
                                  @"shop_id": shopID
                                  };
    
    NSString * url =@"myShop";
    [self remoteLoadDataWithUrl:url Parameters:Parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- å…¨éƒ¨å•†å“æ¥å£
- (void)gotShopShangXinWithUser:(UserInfo *)user storeID:(NSString *)storeID sort:(NSInteger)sort sortOrder:(NSString *)sortOrder pageNumber:(NSInteger)pageNumber success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"SearchShopNew";
    NSDictionary *parameters = @{@"shop_id":storeID,
                                 @"order":@(sort),
                                 @"by":sortOrder,
                                 @"page":@(pageNumber)
                                 };
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}

- (void)gotShopAllGoodsWithUser:(UserInfo *)user storeID:(NSString *)storeID sort:(NSInteger)sort sortOrder:(NSString *)sortOrder pageNumber:(NSInteger)pageNumber success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *parameters = @{@"shop_id":storeID,
                                 @"order":@(sort),
                                 @"by":sortOrder,
                                 @"page":@(pageNumber)
                                 };
    NSString *url = @"MyAllGoods";
    //    url = [self.midPath stringByAppendingString:url];
    //    url = [url stringByAppendingString:self.endPath];
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- åº—é“ºå…¨éƒ¨åˆ†ç±»æ¥å£
- (void)gotShopAllClassDataWithUser:(UserInfo *)user shopID:(NSInteger)shopID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *parameters =@{@"shop_id":@(shopID)};
    NSString *url = @"ShopClassify";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/**å…¨éƒ¨åˆ†ç±»æŸ¥è¯¢*/
- (void)gotShopGoodsDataWithUser:(UserInfo *)user classID:(NSString *)classID sort:(NSInteger)sort sortOrder:(NSString *)sortOrder pageNumber:(NSInteger)pageNumber success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    
    NSDictionary *parameters = @{@"id":classID,
                                 @"order":@(sort),
                                 @"by":sortOrder,
                                 @"page":@(pageNumber)
                                 };
    NSString *url = @"ShopClassify2Goods";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma mark -- åº—é“ºæ•…äº‹
- (void)gotShopStoryDataWithUser:(UserInfo *)user shopID:(NSInteger)shopID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *paramete = @{@"shop_id":@(shopID)};
    NSString *url = @"shopStory";
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- åº—é“ºæœç´¢
- (void)gotShopSearchDataWithUser:(UserInfo *)user shopID:(NSString *)shopID keyword:(NSString *)keyword page:(NSInteger)page sort:(NSInteger)sort sortOrder:(NSString*)sortOrdr success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSDictionary *parmaete =@{@"shop_id":shopID,@"keyword":keyword,@"page":@(page),@"order":@(sort),@"by":sortOrdr};
    NSString *ure = @"SearchShop";
    [self remoteLoadDataWithUrl:ure Parameters:parmaete actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
#pragma mark -- åº—é“ºèµ„è´¨
- (void)gotShopAptiudeDataWithUwer:(UserInfo *)user shopID:(NSInteger)shopID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"MyQuali";
    NSDictionary *paramete = @{@"shop_id":@(shopID)};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}


/** è·å–ä¸ªäººä¸­å¿ƒæ•°æ® */
-(void)gotProfileDataWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://api.zjlao.com/V2/MyPage/rest */
    NSDictionary * parameters = @{
                                  @"member_id":user.member_id
                                  };
    NSString * url = @"MyPage";
    LOG(@"_%@_%d_é€šè¿‡è¿™ä¸ªmemberiDè·å–ä¸ªäººä¿¡æ¯%@",[self class] , __LINE__,parameters);
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}
/** è·å–é¦–é¡µä¿¡æ¯ */
-(void)gotHomeDataWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

        NSDictionary * parameters = @{};
        NSString * url = @"IndexPage";
        
        [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
            success(response);
        } failure:^(NSError *error) {
            failure(error);
        }];
}

-(void)gotGuessLikeDataWithUser:(UserInfo*)user Channel_id:(NSString *)channel_id pageNum:(NSUInteger)pageNum success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    LOG(@"_%@_%d_%ld",[self class] , __LINE__,pageNum);
        NSDictionary * parameters = @{
                                      @"page":@(pageNum),
                                      @"channel_id":channel_id
                                      };
        NSString * url = @"GuessLike";
        [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
            success(response);
        } failure:^(NSError *error) {
            failure(error);
        }];
}
#pragma æä¾¿å®œ
-(void)gotLaoCheapDataWithUser:(UserInfo*)user  pageNum:(NSUInteger)pageNum  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    NSString * url = @"LaoCheap";
    
    LOG(@"_%@_%d_%lu",[self class] , __LINE__,pageNum);
    NSDictionary * prama = @{@"page":@(pageNum)};
    [self remoteLoadDataWithUrl:url Parameters:prama actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

#pragma ææ•…äº‹
-(void)gotLaoStoryDataWithUser:(UserInfo*)user  pageNum:(NSUInteger)pageNum  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

    LOG(@"_%@_%d_%ld",[self class] , __LINE__,pageNum);
    NSString * url = @"LaoStory";
    NSDictionary * prama = @{@"page":@(pageNum)};
    [self remoteLoadDataWithUrl:url Parameters:prama actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** è·å–é¦–é¡µä¸ªä½“è‡ªäº§æ•°æ® */
-(void)gotIndividualDataWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /**
     GET: http://www.zjlao.com/Single&a=rest
     */
    NSDictionary * parame = @{};
    NSString * url = @"Single";
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** è·å–é¦–é¡µç”°å›­ç‰§æ­Œæ•°æ® */
-(void)gotCountrysideDataWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://api.zjlao.com/V2/Countryside/rest*/
    NSDictionary * parame = @{};
    NSString * url = @"Countryside";
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}

/** è·å–é¦–é¡µæ°‘æ—å…„å¼Ÿæ•°æ® */
-(void)gotNationalDataWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://api.zjlao.com/V2/National/rest */
    NSDictionary * parame = @{};
    NSString * url = @"National";
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}


/** é¢†å–ä¼˜æƒ åˆ¸ */
-(void)gotCouponsWithUser:(UserInfo*)user  couponsID:(NSString*)couponsID   success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /**
     POST: http://www.zjlao.com/CouponsTake&a=rest
     */
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"cid":couponsID
                              };
    NSString * url = @"CouponsTake";
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}


/** è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…æ•°æ® */
-(void)gotCouponsDetailDataWithUser:(UserInfo*)user  couponsID:(NSUInteger)couponsID   success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

    /**
     GET: http://www.zjlao.com/CouponsDetail&a=rest
     */
    NSDictionary * parame = @{
                              @"cid":@(couponsID),
                              @"member_id":user.member_id
                              };
    NSString * url = @"CouponsDetail";
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** å…¨ç«™æœç´¢å•†å“ */
-(void)searchGoodsInGlobleWithUser:(UserInfo*)user keyWord:(NSString*)keyWord  order:(NSUInteger)order sortOrder:(NSString *)sortOrder pageNum:(NSUInteger)pageNum channel_id:(NSString *)channel_id success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    /**
     GET: http://www.zjlao.com/SearchSite&a=rest
     */
    LOG(@"_%@_%d_æœç´¢å•†å“çš„å…³é”®è¯æ˜¯:-> %@",[self class] , __LINE__,keyWord);
    NSDictionary * parame=nil;
    if (keyWord) {

         parame = @{
                                  @"keyword":keyWord,
                                  @"order":@(order),
                                  @"page":@(pageNum),
                                  @"by":sortOrder,
                                  @"channel_id":channel_id
                                  };
    
    }else{
    
        parame=@{};
    }
    
    NSString * url = @"SearchSite";
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æœç´¢é¡µï¼ˆçƒ­ã€å†å²ï¼‰ */
-(void)gotSearchPageDataWithUser:(UserInfo*)user    success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /**
     GET: http://www.zjlao.com/SearchSite&a=rest
     */
    NSDictionary * parame = @{};
    
    NSString * url = @"SearchPage";
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/** æ¶ˆæ¯ä¸­å¿ƒæ¥å£ */
-(void)gotMessageCenterDataWithUser:(UserInfo*)user  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/index.php?&m=Api&c=V2/MessageCenter
 */
    NSString * url = @"MessageCenter";
    NSDictionary * parame = @{
                              @"member_id":user.member_id
                              };
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æäº¤è®¢å•å , æŸ¥çœ‹è®¢å•å•†å“åˆ—è¡¨ */
-(void)gotOrderGoodsDetailWithUser:(UserInfo*)user goodsID:(NSString*)goodsID addressID:(NSString*)addressID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    // POST: http://www.zjlao.com/ConfirmGoodsList
    NSDictionary *parameters = nil;
    if (addressID) {
            parameters = @{@"select_id":goodsID,@"member_id":user.member_id ,@"address_id":addressID};
    }else{
            parameters = @{@"select_id":goodsID,@"member_id":user.member_id};
    }
    LOG(@"_%@_%d_%@",[self class] , __LINE__,goodsID);
    NSString *url = @"ConfirmGoodsList";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** æäº¤è®¢å•å , æŸ¥çœ‹è®¢å•å•†å“å¯¹åº”çš„ä¼˜æƒ åˆ¸ */
-(void)gotOrderCouponseListWithUser:(UserInfo*)user goodsID:(NSString*)goodsID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/OrderCoupons */
    NSDictionary *parameters = @{@"select_id":goodsID,@"member_id":user.member_id};
    NSString *url = @"OrderCoupons";
    [self remoteLoadDataWithUrl:url Parameters:parameters actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** ç”Ÿæˆè®¢å• */
-(void)creatOrderWithUserInfo:(UserInfo*)user goods_ID:(NSString*)goodsID payMent:(NSString*)payment shipingType:(NSString*)shipingType invoiceOrNot:(NSString*)invoice couponsIDs:(NSString*)couponsIDs LBCount:(NSString*)lbCount addressID:(NSString*)addressID  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://www.zjlao.com/Order */
    NSString * url = @"Order";
    
    LOG(@"_%@_%d_%@",[self class] , __LINE__,goodsID);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,payment);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,invoice);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,couponsIDs);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,lbCount);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,addressID);
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
//                              @"goods_id":goodsID,
                              @"select_id":goodsID,
                              @"payment":payment,
                              @"shipping": @"",
                              @"invoice":invoice ,
                              @"coupons":couponsIDs ,
                              @"Lcoins": lbCount,
                              @"num":@"",
                              @"address_id":addressID
                              };
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        if (response.status>0) {
            
            [[NSNotificationCenter defaultCenter] postNotificationName:SHOPCARDATACHANGED object:nil];
        }
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** è·å–è®¢å•è¯¦æƒ… */
-(void)gotOrderDetailWithUser:(UserInfo*)user orderID:(NSString*)orderID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/Order */
    NSString * url = @"Order";
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"order_id":orderID
                              };
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/**å–æ¶ˆè®¢å•*/
- (void)cancleOrderWithUser:(UserInfo *)user orderID:(NSString *)orderID success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
    NSString *url = @"DeleteOrder";
    if (!orderID) return;
    NSDictionary *dic = @{@"member_id":user.member_id,
                          @"order_id":orderID,
                          @"_method":@"delete"};
    [self remoteLoadDataWithUrl:url Parameters:dic actionType:POST success:^(ResponseObject *response) {
        LOG(@"%@,%d,%@",[self class], __LINE__,@"å–æ¶ˆè®¢å•æˆåŠŸ")
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
//    [self.mar POST:url parameters:dic progress:^(NSProgress * _Nonnull uploadProgress) {
//        
//    } success:^(NSURLSessionDataTask * _Nonnull task, id  _Nullable responseObject) {
//        LOG(@"%@,%d,%@",[self class], __LINE__,@"å–æ¶ˆè®¢å•æˆåŠŸ")
//        success(responseObject);
//    } failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) {
//        failure(error);
//    } ];
}

/** è·å–åœ°å€åˆ—è¡¨ */
//GET: http://www.zjlao.com/GetAddressList
/** è·å–åœ°å€åˆ—è¡¨ */

-(void)gotAddressWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    NSString * url = @"GetAddressList";
    NSDictionary * parame = @{
                              @"member_id":user.member_id
                              };
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æ–°å»ºæ”¶è´§åœ°å€ */
-(void)creatNewAddressWithUser:(UserInfo *)user addressModel:(AMCellModel*)addressModel  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://www.zjlao.com/Address
 */
    NSString * url = @"Address";
//    LOG(@"_%@_%d_%@",[self class] , __LINE__,[NSString stringWithFormat:@"%@%@%@",addressModel.country,addressModel.province,addressModel.city]);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,addressModel.area_id);
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"username":addressModel.username,
                              @"mobile": addressModel.mobile,
                              @"area":[NSString stringWithFormat:@"%@",addressModel.area] ,
                              @"address":addressModel.address ,
                              @"default": @(addressModel.isDefaultAddress),
                              @"area_id":addressModel.area_id
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}
/** ä¿®æ”¹æ”¶è´§åœ°å€ */
-(void)editAddressWithUser:(UserInfo *)user addressModel:(AMCellModel*)addressModel success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    NSString * url = @"Address";
    LOG(@"_%@_%d_%@%@%@%@%@",[self class] , __LINE__,addressModel.username,addressModel.mobile,addressModel.area,addressModel.ID,addressModel.address);
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"username":addressModel.username,
                              @"mobile": addressModel.mobile,
                              @"area":[NSString stringWithFormat:@"%@",addressModel.area] ,
                              @"address":addressModel.address ,
                              @"default": @(addressModel.isDefaultAddress),
                              @"id":addressModel.ID,
                              @"area_id":addressModel.area_id,
                              @"_method":@"put"
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** åˆ é™¤æ”¶è´§åœ°å€ */
-(void)deleteAddressWithUser:(UserInfo *)user addressModel:(AMCellModel*)addressModel success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
//POST: http://www.zjlao.com/Address
    NSString * url = @"Address";

    LOG(@"_%@_%d_%@",[self class] , __LINE__,addressModel.ID);
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"_method": @"delete",
                              @"address_id":addressModel.ID
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** è®¾ç½®ä¸ºé»˜è®¤åœ°å€ */
-(void)setDefaultAddressWithUser:(UserInfo *)user addressModel:(AMCellModel*)addressModel success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    //POST: http://www.zjlao.com/DefaultAddress
    
    NSString * url = @"DefaultAddress";
    
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"_method": @"put",
                              @"address_id":addressModel.ID
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}
/** è·å–å›½å®¶åˆ—è¡¨ */
-(void)gotCountryListWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/Country */

    NSString * url = @"Country";
    NSDictionary * parame = @{};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/** è·å–çœä»½åˆ—è¡¨ */
-(void)gotProvinceListWithUser:(UserInfo*)user country_id:(NSString*)country_id success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/Province */
    LOG(@"_%@_%d_å›½å®¶id%@",[self class] , __LINE__,country_id);
    NSString * url = @"Province";
    NSDictionary * parame = @{
                              @"country_id":country_id
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}
/** è·å–åŸå¸‚åˆ—è¡¨ */
-(void)gotCityListWithUser:(UserInfo*)user  province_id:(NSString*)province_id success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/City */
    LOG(@"_%@_%d_åŸå¸‚id%@",[self class] , __LINE__,province_id);

    NSString * url = @"City";
    NSDictionary * parame = @{@"province_id": province_id};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** è·å–å›½çœå¸‚åŒºçš„æ€»æ¥å£(æ”¹) */
-(void)gotAreaListWithUser:(UserInfo*)user  areaType:(int)areaType areaID:(NSString*)areaID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://www.zjlao.com/Country */
//    if (!areaID) {
//        areaID=@"0";
//    }
    LOG(@"_%@_%d_åœ°å€ç±»å‹æ˜¯%d    åœ°å€idæ˜¯%@",[self class] , __LINE__,areaType , areaID);
    NSString * url = @"Country";
    NSDictionary * parame = @{@"id":areaID,@"type":@(areaType)};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** ä½™é¢æ”¯ä»˜ */
-(void)payByBalanceWithUser:(UserInfo*)user orderID:(NSString*)orderID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
//GET: http://www.zjlao.com/Balance
    NSString * url = @"Balance";
    LOG(@"_%@_%d_%@",[self class] , __LINE__,orderID);
    NSDictionary * parame = @{@"member_id":user.member_id,@"order_code":orderID};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** æ”¯ä»˜å®è®¢å•ä¿¡æ¯rsaåŠ å¯† */
/** æ”¯ä»˜å®è®¢å•ä¿¡æ¯åŠ å¯† */
-(void)encryptAlipayOrderDataWithUserInfo:(UserInfo*)user orderID:(NSString*)orderID success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/** POST: http://www.zjlao.com/Rsa */
    
    NSString * url = @"Rsa";
    NSDictionary * parame = @{@"member_id":user.member_id,@"order_id":orderID};
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/** éªŒè¯æ”¯ä»˜å®æ”¯ä»˜ç»“æœ */
-(void)verifyAlipayResultWithUserInfo:(UserInfo*)user alipayResult:(NSString*)alipayResult success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/**POST: http://www.zjlao.com/VerifyNotify*/
    NSString * url = @"VerifyNotify";
    NSDictionary * parame = @{@"member_id":user.member_id,@"data":alipayResult};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}




/** è·å–é“¶è”æµæ°´å·tn */
-(void)gotUnionTnWithUserInfo:(UserInfo*)user orderInfo:(NSString*)orderInfo success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

    NSString * url = @"Upmp";
    NSDictionary * parame = @{@"member_id":user.member_id,@"orderId":orderInfo};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/**å¾®ä¿¡ç»Ÿä¸€ä¸‹å•æ¥å£*/
- (void)gotWeiXinUniformOrderWithUser:(UserInfo *)user order_code:(NSString *)order_code Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure {
    NSString *url = @"WXunifiedorder";
    NSLog(@"%@, %d ,%@",[self class],__LINE__,order_code);

    NSDictionary *paramete = @{@"member_id":user.member_id,
                               @"out_trade_no":order_code};
    [self remoteLoadDataWithUrl:url Parameters:paramete actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æ£€æŸ¥ç”¨æˆ·åæˆ–è€…æ‰‹æœºå·æˆ–è€…é‚®ç®±æ˜¯å¦å·²ç»è¢«æ³¨å†Œ ä»¥åŠéªŒè¯ç çš„æœ‰æ•ˆæ€§ */
-(void)checkUserNameOrMobileWithUserInfo:(UserInfo*)user userName:(NSString*)userName mobile:(NSString*)mobile email:(NSString*)email mobilecode:(NSString*)mobilecode success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    NSString * url = @"RegisterVerify";
    LOG(@"_%@_%d_%@",[self class] , __LINE__,userName);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,mobile);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,mobilecode);
    NSDictionary * parame = nil ;
    if (userName.length>0) {
//        parame = @{
//                   @"name":userName,
//                   @"mobile":[NSNull new],
//                   @"password":[NSNull new],
//                   @"mobilecode":[NSNull new]
//                   };
        parame = @{
                   @"name":userName
                   };
    }else if (mobile.length>0&& mobilecode.length==0){
        parame = @{@"mobile":mobile};
    }else if (mobilecode.length>0 &&mobile.length>0){
        parame = @{@"mobilecode":mobilecode,@"mbl":mobile};
        
    }else{
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"å‡ºé—®é¢˜äº†");
    }
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
//POST: http://www.api.zjlao.com/RegisterVerify
    
}
/** æ‰¾å›å¯†ç æ—¶ éªŒè¯ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ , æ£€æŸ¥ç”¨æˆ·åæ—¶æœ‰è¿”å›å€¼çš„,è¿”å›æ‰‹æœºæˆ–è€…é‚®ç®± è·Ÿä¸Šä¸ªæ–¹æ³•å±äºåŒä¸€ä¸ªæ¥å£ , ä¸ºäº†æ˜äº†åˆ†å¼€å†™äº†*/
-(void)checkUserNameOrMobileWithUserInfo:(UserInfo*)user findbackname:(NSString*)findbackname findbackmobile:(NSString*)findbackmobile findbackemail:(NSString*)findbackemail  success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

    NSString * url = @"RegisterVerify";
    LOG(@"_%@_%d_%@",[self class] , __LINE__,findbackname);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,findbackmobile);
    LOG(@"_%@_%d_%@",[self class] , __LINE__,findbackemail);
    NSDictionary * parame = nil ;
    if (findbackname.length>0) {
        parame = @{
                   @"findbackname":findbackname
                   };
    }else if (findbackmobile.length>0){
        parame = @{@"findbackmobile":findbackmobile};
    }else if (findbackemail.length>0 ){
        parame = @{@"findbackemail":findbackemail};
    }else{
        LOG(@"_%@_%d_%@",[self class] , __LINE__,@"å‡ºé—®é¢˜äº†");
    }
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    //POST: http://www.api.zjlao.com/RegisterVerify

}
/** é€šè¿‡ç”¨æˆ·åæˆ–è€…æ‰‹æœºæ‰¾å›å¯†ç  , æ”¹é‚®ç®±æ‰¾å›æ—¶  , åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç»‘å®šé‚®ç®± è·Ÿä¸Šä¸ªæ–¹æ³•å±äºåŒä¸€ä¸ªæ¥å£ , ä¸ºäº†æ˜äº†åˆ†å¼€å†™äº†*/
-(void)gotEmaileWithUser:(UserInfo*)user byUsernameOrMobile:(NSString*)content success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://api.zjlao.com/V2/RegisterVerify/rest */
    NSString * url = @"RegisterVerify";
    NSDictionary * parame = @{
                              @"findbindemail":content
                              } ;

    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** ä¿®æ”¹ä¸ªäººä¿¡æ¯ */
-(void)editUserInfo:(UserInfo*)user withNewUserInfo:(UserInfo*)newUserInfo success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST:http://api.zjlao.com/V2/UserInfo/rest */
    NSString * url = @"UserInfo";
//    NSDictionary * parame = @{
//                              @"_method":@"put",
//                              @"member_id":user.member_id
//                              };
    NSMutableDictionary * parame = [[NSMutableDictionary alloc]init];
    [parame setValue:@"put" forKey:@"_method"];
    [parame setValue:user.member_id forKey:@"member_id"];
    if (newUserInfo.birthday.length>0)[parame setValue:newUserInfo.birthday forKey:@"birthday"];
    
    if (newUserInfo.sex>0) [parame setValue:[NSString stringWithFormat:@"%ld",newUserInfo.sex] forKey:@"sex"];
    if (newUserInfo.nickname.length>0) [parame setValue:newUserInfo.nickname forKey:@"nickname"];

    LOG(@"_%@_%d_%@",[self class] , __LINE__,parame);
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** é‡ç½®å¯†ç  */
-(void)resetPasswordWithUserInfo:(UserInfo*)user withAuthType:(NSString*)authType password:(NSString*)password success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://api.zjlao.com/V2/Password/rest */
    NSString * url = @"Password";
    NSDictionary * parame = @{
                              @"newpassword":password,
                              @"mobile":authType
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:PUT success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** è®¾ç½®å›¾ç‰‡è´¨é‡æ¨¡å¼ */
/**  0:waifaiçŠ¶æ€ 1ï¼šéwaifaiçŠ¶æ€*/
-(void)setupNetworkStatesWithUserInfo:(UserInfo*)user status:(NSUInteger)satus success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://api.zjlao.com/V2/InitWaiFai/rest */

    NSString * url = @"InitWaiFai";
    NSDictionary * parame = @{
                              @"wf":@(satus)//,
                              //  @"mobile":authType
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** è·å–å½“å‰è´¦æˆ·ä½™é¢ */
-(void)gotBanlanceWithUserInfo:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/**GET: http://api.zjlao.com/V2/MyBalance/rest*/
    
    NSString * url = @"MyBalance";
    NSDictionary * parame = @{
                              @"member_id":user.member_id
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}

/** éªŒè¯æ—§ç™»å½•å¯†ç çš„æ­£ç¡®æ€§ */
-(void)checkOldLoginPasswordWithUser:(UserInfo*)user oldLoginPassword:(NSString*)oldLoginPassword success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/**POST: http://api.zjlao.com/V2/CheckOldPwd/rest*/
    NSString * url = @"CheckOldPwd";
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"oldpassword":oldLoginPassword
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
    
}



/** æ‰§è¡Œä¿®æ”¹ç™»å½•å¯†ç çš„æ­£ç¡®æ€§ */
-(void)changeNewLoginPasswordWithUser:(UserInfo*)user newLoginPassword:(NSString*)newLoginPassword success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    
    /** POST: http://api.zjlao.com/V2/ModifyLoginPwd/rest */
    NSString * url = @"ModifyLoginPwd";
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"newpassword":newLoginPassword
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    

}

/** éªŒè¯æ—§æ”¯ä»˜å¯†ç çš„æ­£ç¡®æ€§ *///å°±ä¸èƒ½åˆæˆä¸€ä¸ªæ¥å£å— -_-!
-(void)checkOldPayPasswordWithUser:(UserInfo*)user oldPayPassword:(NSString*)oldPayPassword success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://api.zjlao.com/V2/CheckBalancePwd/rest  */
    NSString * url = @"CheckBalancePwd";
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"balancepwd":oldPayPassword
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** æ‰§è¡Œä¿®æ”¹æ”¯ä»˜å¯†ç çš„æ­£ç¡®æ€§ */
-(void)changeNewPayPasswordWithUser:(UserInfo*)user newPayPassword:(NSString*)newPayPassword success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** POST: http://api.zjlao.com/V2/ModifyBalancePwd/rest  */
    NSString * url = @"ModifyBalancePwd";
    NSDictionary * parame = @{
                              @"member_id":user.member_id,
                              @"balancepwd":newPayPassword
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}


/** è·å–å›½å®¶ç¼–ç  */
-(void)gotCountryNumberWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/** POST: http://api.zjlao.com/V2 / CountryNumber/rest */
    NSString * url = @"CountryNumber";
    NSDictionary * parame = @{ };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];


}

/** ä¿®æ”¹ç»‘å®šæ‰‹æœº */

-(void)changeBoundMobileWithUser:(UserInfo*)user boundMobile:(NSString*)boundMobile success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{

    /** POST: http://api.zjlao.com/V2/ModifyBoundMobile/rest */
    NSString * url = @"ModifyBoundMobile";
    NSDictionary * parame = @{
                              @"newmobile":boundMobile,
                              @"member_id":user.member_id
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST  success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

    
}
/** è·å–è´¦æˆ·å®‰å…¨ç›¸å…³ä¿¡æ¯ */
-(void)gotAccountSafeWithUser:(UserInfo*)user success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
    /** GET: http://api.zjlao.com/V2/SafeAccount/rest */

    NSString * url = @"SafeAccount";
    NSDictionary * parame = @{ @"member_id":user.member_id};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];

}

/** é€šè¿‡é‚®ç®±æ‰¾å›å¯†ç  */
-(void)findPasswordBackByEmailWithUser:(UserInfo*)user email:(NSString*)email success:(void(^)(ResponseObject * responseObject))success failure:(void(^)(NSError*error))failure{
/** POST:http://api.zjlao.com/V2/FindPasswordEmail/rest */
    NSString * url = @"FindPasswordEmail";
    NSDictionary * parame = @{ @"email":email};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST   success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/**è·å–å…¨éƒ¨è®¢å•*/
- (void)gotMyAllOrderWithUser:(UserInfo *)user Success:(void (^)(ResponseObject *))success failure:(void (^)(NSError *))failure{
//    NSString *url = @"MyAllOrder";
    
}
/** æ£€æŸ¥ç‰ˆæœ¬ */
-(void)checkVersionSuccess:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
    /** GET: http://api.zjlao.com/V2/InitVersion/rest */
    NSString * url = @"InitVersion";
    NSDictionary * parame = @{};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        success(response);
    } failure:^(NSError *error) {
        failure(error);
    }];
}

/** é€€å‡ºç™»å½• */
-(void)loginOutWithUser:(UserInfo*)user success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
    /** POST: http://api.zjlao.com/V2/LoginOut/rest */
    NSString * url = @"LoginOut";
        NSDictionary * parame = @{ @"member_id":user.member_id};
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST    success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        [[NSUserDefaults standardUserDefaults] setValue:@(0) forKey:MESSAGECOUNTCHANGED];
        [[NSNotificationCenter defaultCenter]  postNotificationName:MESSAGECOUNTCHANGED object:nil];
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
}
/** (2,ç»‘å®šæ‰‹æœº)é¦–æ¬¡ç¬¬ä¸‰æ–¹ç™»å½•æ—¶ éªŒè¯æ‰‹æœºå·ç  */
-(void)authorMobileAfterThirdPlayformWithUser:(UserInfo*)user mobile:(NSString*)mobile mobileCode:(NSString*)mobileCode accessToken:(NSString*)accessToken success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
    /** POST: http://api.zjlao.com/V2/Author/rest */
    NSString * url = @"Author";
    if (!(mobile&&mobileCode&&accessToken)) {
        return;
    }
    NSDictionary * parame = @{
                              @"mobile":mobile,
                              @"mobilecode":mobileCode,
//                              @"accessToken":accessToken,
                              @"openId":accessToken
                               };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:POST   success:^(ResponseObject *response) {
        [[NSUserDefaults standardUserDefaults] setValue:@(0) forKey:MESSAGECOUNTCHANGED];
        [[NSNotificationCenter defaultCenter]  postNotificationName:MESSAGECOUNTCHANGED object:nil];
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
    

}


/** (1)ç¬¬ä¸‰æ–¹ç™»å½•å,ä¿å­˜ç›¸å…³æ•°æ® sourceæœ‰ä¸‰ç§ QQ sian weixin*/
-(void)saveThirdPlayromAccountInfomation:(UserInfo*)user openID:(NSString*)openID accessToken:(NSString*)accessToken source:(NSString*)source success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
/** POST: http://api.zjlao.com/V2/Author/rest */
    if (!(openID&&source&&accessToken)) {
        return;
    }
    NSString * url = @"Author";
    
    NSDictionary * parame = @{
                              @"openId":openID,
                              @"source":source,
                              @"accessToken":accessToken
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        [[NSUserDefaults standardUserDefaults] setValue:@(0) forKey:MESSAGECOUNTCHANGED];
        [[NSNotificationCenter defaultCenter]  postNotificationName:MESSAGECOUNTCHANGED object:nil];
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
}


-(void)saveThirdPlayromAccountInfomation:(UserInfo*)user andSnsAccount:(UMSocialAccountEntity *)snsAccount origenRespons:(UMSocialResponseEntity *)origenRespons success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
    /** POST: http://api.zjlao.com/V2/Author/rest */
    NSString * url = @"Author";

    NSMutableDictionary * parame = [[NSMutableDictionary alloc]init];
    if (snsAccount.openId) {
        [parame setObject:snsAccount.openId forKey:@"openId"];
    }else if (snsAccount.usid){
        [parame setObject:snsAccount.usid forKey:@"openId"];
    }
    if (snsAccount.platformName) {
        [parame setObject:snsAccount.platformName forKey:@"source"];
    }
    if (snsAccount.accessToken) {
        [parame setObject:snsAccount.accessToken forKey:@"accessToken"];
    }

    
    
    NSMutableDictionary * info = [[NSMutableDictionary alloc]init];
    if (snsAccount.userName) {
        [info setObject:snsAccount.userName forKey:@"name"];
    }else{
         [info setObject:@"" forKey:@"name"];
    }
    if (snsAccount.iconURL) {
        [info setObject:snsAccount.iconURL forKey:@"headImage"];
    }else{
        [info setObject:@"" forKey:@"headImage"];
    }
    if ([origenRespons.thirdPlatformUserProfile isKindOfClass:[NSDictionary class]] && origenRespons.thirdPlatformUserProfile[@"birthday"]) {
        [info setObject:origenRespons.thirdPlatformUserProfile[@"birthday"] forKey:@"birthday"];
    }else{
        [info setObject:@"" forKey:@"birthday"];
    }
    if ([origenRespons.thirdPlatformUserProfile isKindOfClass:[NSDictionary class]] && origenRespons.thirdPlatformUserProfile[@"sex"]) {
        [info setObject:origenRespons.thirdPlatformUserProfile[@"sex"] forKey:@"sex"];
    }else if ([origenRespons.thirdPlatformUserProfile isKindOfClass:[NSDictionary class]] && origenRespons.thirdPlatformUserProfile[@"gender"]){
        [info setObject:origenRespons.thirdPlatformUserProfile[@"gender"] forKey:@"sex"];
    }else {
        [info setObject:@"" forKey:@"sex"];
    }
    
    
    
    [parame setObject:info.mj_JSONString forKey:@"info"];
    
    
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        [[NSUserDefaults standardUserDefaults] setValue:@(0) forKey:MESSAGECOUNTCHANGED];
        [[NSNotificationCenter defaultCenter]  postNotificationName:MESSAGECOUNTCHANGED object:nil];
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
}


/** æ”¯ä»˜å®æ”¯ä»˜ç»“æœå¤„ç† */
-(void)dealTheResultAfterAlipayWithUser:(UserInfo*)user payType:(NSString*)payType payResult:(NSString*)payResult success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
/** POST: http://api.zjlao.com/V2/Pay/rest */
    
    NSString * url = @"Pay";
    
    NSDictionary * parame = @{
                              @"pay_type":@"1",
                              @"order_code":payResult
                              };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
    
}
/** æ¸…æ¥šè¶³è¿¹ */
-(void)clearFootHistoryWith:(UserInfo*)user success:(void(^)(ResponseObject *responseObject))success failure:(void(^)(NSError *error))failure{
    
    /** GET: http://api.zjlao.com/V2/CleanMyFoot/rest */
    NSString * url = @"CleanMyFoot";
    
    NSDictionary * parame =  @{
                                //@"member_id":user.member_id
                                };
    [self remoteLoadDataWithUrl:url Parameters:parame actionType:GET   success:^(ResponseObject *response) {
        LOG(@"_%@_%d_%@",[self class] , __LINE__,response.data);
        success(response);
        
    } failure:^(NSError *error) {
        failure(error);
    }];
}
@end
